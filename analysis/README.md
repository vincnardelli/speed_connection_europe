# NUTS Analysis - European Connectivity & Healthcare Accessibility

Comprehensive analysis of internet connectivity and healthcare accessibility across European NUTS regions (levels 0-3).

## Quick Start

```bash
# From project root
cd analysis
python3 run_analysis.py
```

**Output**: `european_analysis_results.xlsx` (single Excel file with all results)

**Processing time**: ~25 minutes

## What's Included

### Excel Report (13 Sheets)

Single file: **`european_analysis_results.xlsx`**

1. **Summary** - Key findings across Europe
2-6. **Connectivity_[Level]** - Internet speed analysis (Europe, NUTS0-3)
7-11. **Healthcare_[Level]** - Healthcare accessibility (Europe, NUTS0-3)
12-13. **Demographics** - Underserved vs. well-connected populations

### Visualizations (300 DPI PNG)

**Maps** (`figures/maps/`):
- Connectivity by NUTS level (0-3)
- Healthcare accessibility by NUTS level (0-3)
- Underserved population distribution

**Charts** (`figures/charts/`):
- Population by speed tier
- Healthcare distance distribution
- Demographics comparison

### Documentation

- **`metadata.md`** - Complete methodology, data sources, NUTS classification

## Key Metrics

### Internet Connectivity

**Speed Tiers**:
- Disconnected: No speed data
- Very Poor: <10 Mbps
- Poor: 10-25 Mbps
- Basic: 25-100 Mbps
- Good: ≥100 Mbps

**Analysis**:
- Population by tier (fixed & mobile)
- Underserved count (disconnected + <10 Mbps)
- Coverage and mean speeds by region

### Healthcare Accessibility

**Travel Time Categories**:
- Very Close: <5 min
- Close: 5-10 min
- Moderate: 10-15 min
- Far: 15-30 min
- Very Far: >30 min

**Analysis**:
- Population distribution by category
- Mean/median travel time by region
- Population beyond thresholds (>5, >10, >15, >30 min)

### Demographics

**Comparison Groups**:
- Underserved: Disconnected + <10 Mbps
- Well-Connected: ≥100 Mbps

**Metrics**:
- Age distribution (0-14, 15-64, 65+)
- Gender ratio
- Population density
- Healthcare accessibility

## Pipeline Structure

### Scripts (Run Sequentially)

1. **`01_prepare_nuts_data.py`**
   - Spatial join: H3 hexagons → NUTS regions (levels 0-3)
   - Output: `data/h3_with_nuts.parquet`

2. **`02_analyze_connectivity.py`**
   - Classify speed tiers
   - Aggregate by NUTS levels
   - Output: `data/connectivity_analysis.parquet`, `connectivity_stats.parquet`

3. **`03_analyze_healthcare.py`**
   - Classify travel time categories
   - Aggregate by NUTS levels
   - Output: `data/healthcare_analysis.parquet`, `healthcare_stats.parquet`

4. **`04_demographics.py`**
   - Profile underserved vs. well-connected populations
   - Output: `data/demographics_analysis.parquet`

5. **`05_generate_maps.py`**
   - Create publication-ready maps and charts
   - Output: `figures/maps/*.png`, `figures/charts/*.png`

### Orchestrator

**`run_analysis.py`** - Runs all scripts + generates Excel report

## Data Requirements

### Input Files

1. **`../data/data_h3_res8.parquet`**
   - H3 hexagons with population, health, internet data
   - Generated by main pipeline: `python3 ../run_pipeline.py`

2. **`../data/statistical_units/NUTS_RG_60M_2024_3035.gpkg`**
   - NUTS boundaries (2024 classification)
   - Download from Eurostat GISCO

### Expected Columns

From `data_h3_res8.parquet`:
- `h3_index`, `lat`, `lon`
- `pop_total`, `pop_male`, `pop_female`, `pop_age_*`
- `health_distance`
- `fixed_download_2023`, `mobile_download_2023`

## Running Individual Scripts

```bash
# Step by step
python3 scripts/01_prepare_nuts_data.py
python3 scripts/02_analyze_connectivity.py
python3 scripts/03_analyze_healthcare.py
python3 scripts/04_demographics.py
python3 scripts/05_generate_maps.py

# Then create Excel manually (or use run_analysis.py)
```

## Requirements

**Software**:
- Python 3.9+
- Dependencies in `../requirements.txt`

**Hardware**:
- 16 GB RAM minimum (32 GB recommended)
- 10 GB disk space for outputs

**Key Libraries**:
- polars, pandas (data processing)
- geopandas, h3 (spatial operations)
- matplotlib (visualization)
- openpyxl (Excel export)

## Output Details

### Excel File Structure

Each sheet follows publication standards:
- Formatted headers (blue background, white text)
- Number formatting (thousands separator, decimals)
- Clear column labels
- Proper data types

**Connectivity Sheets**:
- Columns: Region, Disconnected, Very Poor, Poor, Basic, Good, Total Underserved, Mean Speed
- Rows: One per NUTS region

**Healthcare Sheets**:
- Columns: Region, <5min, 5-10min, 10-15min, 15-30min, >30min, Mean Distance, >15min Total
- Rows: One per NUTS region

**Demographics Sheets**:
- Comparison metrics between underserved and well-connected
- Age, gender, density, healthcare access

### Maps

**Specifications**:
- Format: PNG, 300 DPI
- Projection: EPSG:3035 (LAEA Europe)
- Style: Clean, publication-ready
- Size: 12×10 inches
- Color schemes: ColorBrewer palettes

**Types**:
- Choropleth maps (% disconnected, mean healthcare distance)
- Clear legends, no clutter
- Data source citations

### Charts

**Specifications**:
- Format: PNG, 300 DPI
- Style: Matplotlib publication theme
- Font size: 9-12pt
- White background, grid lines

**Types**:
- Stacked bars (population by tier)
- Histograms (distributions)
- Comparison charts (demographics)

## Validation

The pipeline includes validation checks:
- Population totals match source data
- All hexagons assigned to NUTS regions
- No negative values
- Percentages sum to 100%

## Known Limitations

1. **Internet coverage**: 21% of populated areas lack speed data
2. **NUTS boundaries**: 60M scale, generalized for visualization
3. **H3 assignment**: Border hexagons assigned by centroid
4. **Temporal mismatch**: Census 2021, Healthcare 2023, Internet 2023

See `metadata.md` for full details.

## Troubleshooting

**"File not found: data_h3_res8.parquet"**
```bash
cd ..
python3 run_pipeline.py
```

**"NUTS layer not found"**
- Check GeoPackage file exists: `data/statistical_units/NUTS_RG_60M_2024_3035.gpkg`
- Download from: https://ec.europa.eu/eurostat/web/gisco/geodata/statistical-units/territorial-units-statistics

**"Out of memory"**
- Close other applications
- Process NUTS levels separately
- Reduce map resolution in script

**"Module not found"**
```bash
pip install -r ../requirements.txt
```

## Citation

If you use this analysis in research:

```
Speed Connection Europe - NUTS Analysis (2026)
European Connectivity and Healthcare Accessibility Analysis
NUTS 2024 Classification, Census 2021, Ookla 2023
https://github.com/[username]/speed_connection_europe
```

## References

1. Eurostat NUTS 2024: https://ec.europa.eu/eurostat/web/nuts
2. Eurostat Census 2021: https://ec.europa.eu/eurostat/web/gisco/geodata/population-distribution
3. JRC Healthcare Accessibility 2023: https://data.jrc.ec.europa.eu/
4. Ookla Open Data: https://github.com/teamookla/ookla-open-data

## License

Code: MIT  
Data outputs: CC BY 4.0  
See main project repository for details

---

**Version**: 1.0  
**Last Updated**: January 2026  
**Status**: Production
